<template>
  <div class="set-category">
    <!-- ÏàòÏûÖ/ÏßÄÏ∂ú Ïπ¥ÌÖåÍ≥†Î¶¨ ÏïÑÏù¥ÏΩò ÏàòÏ†ï -->
    <div class="category-list-cont">
      <h3 class="font-jua">ÏàòÏûÖ / ÏßÄÏ∂ú Ïπ¥ÌÖåÍ≥†Î¶¨</h3>
      <form action="">
        <b class="explanation" v-if="getCategory.length !== 0"
          >( ÌòÑÏû¨ {{ getCategory.length }}Í∞úÏùò Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä Ï†ÄÏû•ÎêòÏñ¥ ÏûàÏäµÎãàÎã§.
          )</b
        >
        <ul>
          <b class="explanation" v-if="getCategory.length === 0"
            >Ï∂îÍ∞Ä Îêú Ïπ¥ÌÖåÍ≥†Î¶¨Í∞Ä Î≥¥Ïó¨ÏßÄÎäî Í≥µÍ∞ÑÏûÖÎãàÎã§.</b
          >
          <li v-for="category in getCategory" :key="category.id">
            <label
              ><input type="radio" name="category" />
              <!-- Ï∂îÌõÑÏóê span ÏòÜÏóê ÏÑ†ÌÉùÌïú ÏïÑÏù¥ÏΩòÎèÑ ÎÑ£Ïñ¥Ï§Ñ Í≤É -->
              <div
                :class="{ click: categoryCardClick === true }"
                @click="clickCategoryCard()"
              >
                <i :class="category.icon"></i>
                <span :class="{ click: categoryCardClick === true }">{{
                  category.name
                }}</span>
              </div>
              <button
                :class="{ click: categoryCardClick === true }"
                @click.prevent="clickRemoveCategory()"
              >
                ‚úï
              </button>
            </label>
          </li>
        </ul>

        <button
          class="btn small"
          :class="{ click: categoryCardClick === true }"
          @click="clickCategoryEdit()"
        >
          ÏàòÏ†ï
        </button>
      </form>
    </div>

    <!-- category Ïù¥Î¶Ñ + ÏïÑÏù¥ÏΩò ÏÑ†ÌÉù -->
    <div class="category-edit-cont">
      <strong>Ïπ¥ÌÖåÍ≥†Î¶¨ Ï∂îÍ∞Ä</strong>
      <b class="explanation"
        >* Ï∂îÍ∞Ä/ÏàòÏ†ï Ìï† Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö ÏûÖÎ†• ÌõÑ ÏõêÌïòÎäî ÏïÑÏù¥ÏΩòÏùÑ ÏÑ†ÌÉùÌï¥ Ï£ºÏÑ∏Ïöî</b
      >
      <form action="">
        <input
          type="text"
          placeholder="Ï∂îÍ∞ÄÌï† Ïπ¥ÌÖåÍ≥†Î¶¨Î•º ÏûÖÎ†•Ìï¥ Ï£ºÏÑ∏Ïöî"
          v-model="inputCategory.name"
        />

        <ul>
          <li>
            <label for="">
              <!-- <input type="radio" name="icon" /> -->
              <input
                type="radio"
                name="icon"
                value="fas fa-wallet"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-wallet"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-piggy-bank"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-piggy-bank"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-shopping-cart"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-shopping-cart"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-shopping-basket"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-shopping-basket"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-gifts"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-gifts"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-birthday-cake"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-birthday-cake"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-tshirt"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-tshirt"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-baby"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-baby"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-child"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-child"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-bicycle"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-bicycle"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-basketball-ball"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-basketball-ball"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-futbol"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-futbol"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-bone"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-bone"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-cat"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-cat"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-briefcase-medical"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-briefcase-medical"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-clinic-medical"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-clinic-medical"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-bus"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-bus"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-car"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-car"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-subway"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-subway"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-charging-station"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-charging-station"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-gas-pump"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-gas-pump"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-home"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-home"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-building"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-building"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-school"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-school"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-utensils"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-utensils"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-hamburger"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-hamburger"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-pizza-slice"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-pizza-slice"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-cocktail"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-cocktail"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-coffee"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-coffee"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-beer"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-beer"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-suitcase-rolling"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-suitcase-rolling"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-plane"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-plane"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-couch"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-couch"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-camera"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-camera"></i>
            </label>
          </li>
          <li>
            <label for="">
              <input
                type="radio"
                name="icon"
                value="fas fa-desktop"
                v-model="inputCategory.icon"
              />
              <i class="fas fa-desktop"></i>
            </label>
          </li>
        </ul>

        <!-- ÏúÑÏùò ÏàòÏ†ï Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ 'Ï∂îÍ∞Ä'Î≤ÑÌäºÏù¥ 'ÏàòÏ†ï'ÏúºÎ°ú Î∞îÎÄåÎèÑÎ°ù Ìï† Í≤É -->
        <button class="btn small" @click.prevent="clickAddCategory()">
          Ï∂îÍ∞Ä
        </button>
        <!-- <button>ÏàòÏ†ï</button> -->
      </form>
    </div>
  </div>
</template>

<script>
// import { saveCategory } from '@/utils/cookies.js';
import { makeID } from '@/utils/filters.js';
import { moneybooRef, settingColRef } from '@/api/firestore';
import firebase from 'firebase';

export default {
  data() {
    return {
      // ÏÉàÎ°ú ÏûÖÎ†•Ìïú Ïπ¥ÌÖåÍ≥†Î¶¨ & ÏàòÏ†ïÌï† Ïπ¥ÌÖåÍ≥†Î¶¨
      inputCategory: {
        name: '',
        icon: '',
        id: '',
      },
      // // cookieÏóê Ï†ÄÏû• Îêú category Í∞úÏàò
      // categoryNum: '',
      // // Î∂àÎü¨Ïò® Ïπ¥ÌÖåÍ≥†Î¶¨Î™Ö
      // showCategoryName: this.$store.state.categorys.name,
      // // Î∂àÎü¨Ïò® Ïπ¥ÌÖåÍ≥†Î¶¨ ÏïÑÏù¥ÏΩòÎ™Ö
      // showCategoryIcon: this.$store.state.categorys.icon,
      // // Î∂àÎü¨Ïò® Ïπ¥ÌÖåÍ≥†Î¶¨ id
      // showCategoryId: this.$store.state.categorys.id,
      // Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÅ¥Î¶≠ Ïó¨Î∂Ä ÌôïÏù∏Ïö©
      categoryCardClick: false,
      currentUid: this.$store.state.uid, // ÌòÑÏû¨ Î°úÍ∑∏Ïù∏Ìïú Ïú†Ï†ÄÏùò uid
      // logMessage: '',
      getCategory: [],
    };
  },
  created() {
    this.categoryNum = this.$store.state.categorys.name.length;

    // firestoreÏóê Ï†ÄÏû•Îêú category DB Í∞ÄÏ†∏Ïò§Í∏∞

    this.mbooRef()
      .doc('settings')
      .get()
      .then(docSnapshot => {
        // documentÍ∞Ä Ï°¥Ïû¨ÌïòÎ©¥
        if (docSnapshot.exists) {
          const setCategory = docSnapshot.data().setCategory;

          // setCategory Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥
          if (setCategory) {
            setCategory.forEach(data => {
              this.getCategory.push(data);
            });

            // setCategory Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥
          } else {
            this.logMessage = 'Ïπ¥ÌÖåÍ≥†Î¶¨ Í∞íÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!';
          }

          // documentÍ∞Ä ÏóÜÏúºÎ©¥
        } else {
          this.logMessage = 'ÏÖãÌåÖ Í∞íÏùÑ ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî!';
        }
      })
      .catch(err => {
        console.log('ÏóêÎü¨ Î∞úÏÉùÌïú ÏúÑÏπò setCategory.vue createdÎ∂ÄÎ∂Ñ', err);
      });

    this.getFirebase();
  },
  methods: {
    clickAddCategory() {
      // cookieÏóê Ï†ÄÏû•Ìï† Îïå Ìï®Íªò Ï†ÄÏû•Ìï† Í∞ÅÍ∞ÅÏùò idÏÉùÏÑ±.
      this.inputCategory.id = makeID('category');
      // cookies.jsÏóê ÏûàÎäî saveCategory()Ìï®Ïàò Ïã§Ìñâ.
      let newCategory = `${this.inputCategory.name}|${this.inputCategory.icon}|${this.inputCategory.id}`;
      console.log(newCategory);

      // console.log('newCategory', newCategory);
      // // firestoreÏóê category DB Ï†ÄÏû•
      // this.mbooRef()
      //   .doc('settings')
      //   .get()
      //   .then(docSnapshot => {
      //     // ÎßåÏïΩ documentÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏúºÎ©¥ Ï¥àÍ∏∞Í∞í ÏÖãÌåÖ
      //     if (!docSnapshot.exists) {
      //       this.mbooRef()
      //         .doc('settings')
      //         .set({ setCategory: [this.inputCategory] }); // Î∞∞Ïó¥Î°ú ÎÑòÍ≤®Ï§å

      //       this.logMessage = '';

      //       // ÎßåÏïΩ documentÏóê Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÎã§Î©¥ Î∞∞Ïó¥ÏùÑ ÏóÖÎç∞Ïù¥Ìä∏
      //     } else {
      //       this.mbooRef()
      //         .doc('settings')
      //         .update({
      //           setCategory: firebase.firestore.FieldValue.arrayUnion(
      //             this.inputCategory,
      //           ),
      //         });
      //     }

      //     //this.resetInputCategory(); // category inputÏ∞Ω Î¶¨ÏÖã.
      //   });
      // saveCategory(newCategory); // cookieÏóê category Ï†ÄÏû•.

      // --------0826 setting Íµ¨Ï°∞ Î∞îÍøà (ÌôïÏù∏ÌïòÏãúÍ≥† ÏÇ≠Ï†úÎ∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§!) üòÄ
      // categories docÏóê Ï†ÄÏû•
      this.settingListRef()
        .doc('categories')
        .get()
        .then(doc => {
          console.log(doc);
          // categories docÏù¥ ÏûàÏúºÎ©¥? => update
          if (doc.exists) {
            this.settingListRef()
              .doc('categories')
              .update({
                categories: firebase.firestore.FieldValue.arrayUnion(
                  this.inputCategory,
                ),
              });
            // categories docÏù¥ ÏóÜÏúºÎ©¥? => set
          } else {
            this.settingListRef()
              .doc('categories')
              .set({
                categories: [this.inputCategory],
              });
          }

          this.resetInputCategory();
        })
        .catch(err => {
          console.log(
            'setCategory.vueÏóê ÏûàÎäî clickAddCategoryÌï®ÏàòÏóêÏÑú ÎÇòÏò® ÏóêÎü¨!!',
            err,
          );
        });
    },
    // [Ï∂îÍ∞Ä]Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú category ÏûÖÎ†• Ï∞Ω ÎπÑÏõåÏ§å.
    resetInputCategory() {
      this.inputCategory.name = '';
      this.inputCategory.icon = '';
      this.inputCategory.id = '';
    },
    // Î®∏ÎãàÎ∂Ä Ï∞∏Ï°∞Í∞í
    mbooRef() {
      return moneybooRef(this.currentUid);
    },
    // --------0826 setting Íµ¨Ï°∞ Î∞îÍøà (ÌôïÏù∏ÌïòÏãúÍ≥† ÏÇ≠Ï†úÎ∂ÄÌÉÅÎìúÎ¶ΩÎãàÎã§!) üòÄ
    // settings document > settingList collection Ï∞∏Ï°∞Í∞í
    settingListRef() {
      return settingColRef(this.currentUid);
    },
    // firestoreÏóê Ï†ÄÏû•Îêú category DB Í∞ÄÏ†∏Ïò§Í∏∞ (created()ÏóêÏÑú Ìï®Ïàò Ïã§Ìñâ)
    getFirebase() {
      this.mbooRef()
        .doc('settings')
        .onSnapshot(snapshot => {
          // console.log(snapshot.data());
          // console.log(snapshot.data().setCategory);
          // documentÍ∞Ä Ï°¥Ïû¨ÌïòÎ©¥
          if (snapshot.exists) {
            const setCategory = snapshot.data().setCategory;
            // setCategory Îç∞Ïù¥ÌÑ∞Í∞Ä ÏûàÏúºÎ©¥
            if (setCategory) {
              this.getCategory = setCategory;
            }
          }
        });
    },

    clickCategoryCard() {
      // ÌôîÎ©¥Ïóê Î≥¥Ïù¥Îäî Ïπ¥ÌÖåÍ≥†Î¶¨ ÌÅ¥Î¶≠Ìï† ÎïåÎßàÎã§ ture, falseÍ∞íÏùÑ Ï§òÏÑú [ÏàòÏ†ï]Î≤ÑÌäº ÌôúÏÑ±, ÎπÑÌôúÏÑ±Ìôî ÎêòÍ≤å Ìï¥Ï§å. + ÌÅ¥Î¶≠Ìïú Ìï¥Îãπ Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò Î∞∞Í≤ΩÏÉâ, Í∏ÄÏûêÏÉâ Î≥ÄÍ≤ΩÌïòÍ∏∞ ÏúÑÌïú :class Ï£ºÎäî Ïö©ÎèÑ.
      if (this.categoryCardClick === false) {
        this.categoryCardClick = true;
      } else {
        this.categoryCardClick = false;
      }
      console.log('click', this.categoryCardClick);
    },
    clickRemoveCategory() {
      console.log('Ïù¥ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏÇ≠Ï†úÌïòÏûê!!!');
      // ÌÅ¥Î¶≠Ìïú Ïπ¥ÌÖåÍ≥†Î¶¨Ïùò idÎ•º Íµ¨Ìï¥ÏÑú Ïù¥ Ìï®ÏàòÎ°ú Î≥¥ÎÇ¥Ï§Ñ Ïàò ÏûàÏúºÎ©¥ Ìé∏Ìï† Í≤É Í∞ôÏùÄÎç∞...!
      console.log(this.getCategory);

      this.mbooRef()
        .where(typeof 'settings.setCategory.id', '==', 'string')
        .onSnapshot(snapshot => {
          console.log(snapshot);
          snapshot.docChanges().forEach(change => {
            if (change.type === 'added') {
              console.log('New city: ', change.doc.data());
            }
            if (change.type === 'modified') {
              console.log('Modified city: ', change.doc.data());
            }
            if (change.type === 'removed') {
              console.log('Removed city: ', change.doc.data());
            }
          });
        });
    },
    clickCategoryEdit() {
      console.log('Ïù¥ Ïπ¥ÌÖåÍ≥†Î¶¨ ÏàòÏ†ïÌïòÏûê!!!!');
    },
  },
};
</script>

<style></style>
